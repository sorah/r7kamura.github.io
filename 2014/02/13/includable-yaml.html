<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" />
    <title>Includable YAML - r7kamura per second</title><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><link href="/stylesheets/all.css?1394610828" media="all" rel="stylesheet" type="text/css" /><link href="/images/favicon.ico" rel="icon" type="image/ico" />
  </head>
  <body>
    <header class="header">
      <div class="header-inner"><a href="/">
        <div class="header-image">
          <img width="100" height="100" class="header-image-element" src="/images/r7kamura.png?1394610828" />
        </div>
        <div class="header-text">
          <h1 class="header-text-title">
            r7kamura per second
          </h1>
          <p class="header-text-description">
            Bits of technologies piled up here and there.
          </p>
        </div></a>
        
      </div>
    </header>
    <div class="main">
      <div class="main-inner main-inner-single-article"><article class="main-article">
  <div class="main-article-header">
    <h1 class="main-article-header-title">
      Includable YAML
    </h1>
    <div class="main-article-header-date">
      2014-02-13
    </div>
  </div><p>YAMLの定義内で別のファイルに書いたYAMLを参照出来るようにしてみた。</p>

<h2>YAMLに加える変更</h2>

<p>YAMLの各要素には任意のタグを埋め込むことができ、またその振る舞いを定義出来る。</p>

<pre><code class="ruby"># test.rb
require &quot;yaml&quot;

YAML.add_domain_type(nil, &quot;include&quot;) do |type, val|
  YAML.load_file(val)
end

# 折角なので再度YAMLに加工して出力してみる
puts YAML.load_file(&quot;api.yml&quot;).to_yaml
</code></pre>

<h2>Includeする側</h2>

<p>例えば、レシピデータを返すREST APIの仕様をYAMLで定義するというユースケースを考える。
レシピのスキーマをrecipe.ymlに書いて、各APIから定義を使い回すことにする。</p>

<pre><code># api.yml
/recipes:
  GET:
    response:
      array: !include recipe.yml

/recipe/{id}:
  GET:
    response: !include recipe.yml
</code></pre>

<h2>Includeされる側</h2>

<p>これがレシピのスキーマ定義。</p>

<pre><code># recipe.yml
id:
  type: integer
  minValue: 1
  description: Unique ID of the Recipe
name:
  type: string
  description: The human-readable name of the Recipe
</code></pre>

<h2>実行例</h2>

<p>こんな感じで出力されてrecipe.ymlがうまく埋め込まれてることが分かる。</p>

<pre><code>$ ruby test.rb
---
/recipes:
  GET:
    response:
      array:
        id:
          type: integer
          minValue: 1
          description: Unique ID of the Recipe
        name:
          type: string
          description: The human-readable name of the Recipe
/recipe:
  GET:
    response:
      id:
        type: integer
        minValue: 1
        description: Unique ID of the Recipe
      name:
        type: string
        description: The human-readable name of the Recipe
</code></pre>

</article>
      </div>
    </div>
    <footer class="footer">
      <div class="footer-inner">
        <p class="footer-copyright">
          Copyright &copy; 2013-2014 by <a target="_blank" href="http://twitter.com/r7kamura">@r7kamura</a>
        </p>
        <p class="footer-powers">
          Powered by <a href="https://github.com/r7kamura/r7kamura.github.io">Github</a> & <a href="https://travis-ci.org/r7kamura/r7kamura.github.io">Travis CI</a> & <a href="https://github.com/r7kamura/sitespec">Sitespec</a>
        </p>
      </div>
    </footer>
  </body>
</html>